<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Analysis - Optimized Dashboard</title>
    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-tertiary: #e9ecef;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --border-color: #dee2e6;
            --error-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #0dcaf0;
            --success-color: #198754;
            --style-color: #6f42c1;
            --hover-bg: #f8f9fa;
            --shadow: 0 1px 3px rgba(0,0,0,0.12);
            --font-mono: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', monospace;
        }
        
        [data-theme="dark"] {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --bg-tertiary: #3a3a3a;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0a0;
            --border-color: #404040;
            --hover-bg: #2d2d2d;
            --shadow: 0 1px 3px rgba(0,0,0,0.5);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
        }
        
        /* Header */
        .header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
            background: rgba(var(--bg-secondary), 0.95);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .title {
            font-size: 1.5rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .stats-bar {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .stat-badge {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .stat-badge:hover {
            transform: translateY(-1px);
        }
        
        .stat-badge.error {
            background: rgba(220, 53, 69, 0.1);
            color: var(--error-color);
            border: 1px solid rgba(220, 53, 69, 0.3);
        }
        
        .stat-badge.warning {
            background: rgba(255, 193, 7, 0.1);
            color: #f39c12;
            border: 1px solid rgba(255, 193, 7, 0.3);
        }
        
        .stat-badge.style {
            background: rgba(111, 66, 193, 0.1);
            color: var(--style-color);
            border: 1px solid rgba(111, 66, 193, 0.3);
        }
        
        .stat-badge.performance {
            background: rgba(25, 135, 84, 0.1);
            color: var(--success-color);
            border: 1px solid rgba(25, 135, 84, 0.3);
        }
        
        .stat-badge.information {
            background: rgba(13, 202, 240, 0.1);
            color: var(--info-color);
            border: 1px solid rgba(13, 202, 240, 0.3);
        }
        
        /* Controls */
        .controls {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem;
            position: sticky;
            top: 73px;
            z-index: 90;
        }
        
        .controls-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .search-box {
            flex: 1;
            min-width: 300px;
            position: relative;
        }
        
        .search-input {
            width: 100%;
            padding: 0.5rem 2.5rem 0.5rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 0.875rem;
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--style-color);
            box-shadow: 0 0 0 3px rgba(111, 66, 193, 0.1);
        }
        
        .search-hint {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        .control-buttons {
            display: flex;
            gap: 0.5rem;
        }
        
        .control-btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .control-btn:hover {
            background: var(--hover-bg);
            border-color: var(--style-color);
        }
        
        .control-btn.active {
            background: var(--style-color);
            color: white;
            border-color: var(--style-color);
        }
        
        /* Main Content */
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem;
        }
        
        /* Progress Bar */
        .progress-section {
            margin-bottom: 2rem;
            background: var(--bg-secondary);
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid var(--border-color);
        }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }
        
        .progress-bar {
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success-color), var(--style-color));
            transition: width 0.3s;
        }
        
        /* File Groups */
        .file-group {
            margin-bottom: 1rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            overflow: hidden;
            transition: all 0.2s;
        }
        
        .file-group:hover {
            box-shadow: var(--shadow);
        }
        
        .file-header {
            padding: 1rem;
            background: var(--bg-secondary);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
        }
        
        .file-header:hover {
            background: var(--hover-bg);
        }
        
        .file-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .file-name {
            font-weight: 500;
            font-family: var(--font-mono);
            font-size: 0.875rem;
        }
        
        .issue-count {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        .severity-dots {
            display: flex;
            gap: 2px;
        }
        
        .severity-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        
        .severity-dot.error { background: var(--error-color); }
        .severity-dot.warning { background: var(--warning-color); }
        .severity-dot.style { background: var(--style-color); }
        .severity-dot.performance { background: var(--success-color); }
        .severity-dot.information { background: var(--info-color); }
        
        .file-toggle {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        /* Issues */
        .issues-container {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s;
        }
        
        .issues-container.expanded {
            max-height: none;
        }
        
        .issue-item {
            padding: 0.75rem 1rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            transition: background 0.2s;
        }
        
        .issue-item:hover {
            background: var(--hover-bg);
        }
        
        .issue-item.viewed {
            opacity: 0.7;
        }
        
        .issue-item.fixed {
            text-decoration: line-through;
            opacity: 0.5;
        }
        
        .issue-severity {
            flex-shrink: 0;
            padding: 0.125rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .issue-content {
            flex: 1;
            min-width: 0;
        }
        
        .issue-message {
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }
        
        .issue-code {
            font-family: var(--font-mono);
            font-size: 0.8rem;
            background: var(--bg-tertiary);
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            margin: 0.25rem 0;
            overflow-x: auto;
            white-space: pre;
        }
        
        .issue-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        .issue-actions {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        
        .action-btn {
            padding: 0.25rem 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 0.25rem;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .action-btn:hover {
            background: var(--hover-bg);
            border-color: var(--style-color);
        }
        
        .fix-suggestion {
            background: rgba(25, 135, 84, 0.1);
            color: var(--success-color);
            border-color: rgba(25, 135, 84, 0.3);
        }
        
        /* Theme Toggle */
        .theme-toggle {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            padding: 0.75rem;
            border-radius: 50%;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: all 0.2s;
        }
        
        .theme-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        /* Toast */
        .toast {
            position: fixed;
            bottom: 4rem;
            right: 1rem;
            padding: 1rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            box-shadow: var(--shadow);
            transform: translateX(400px);
            transition: transform 0.3s;
            z-index: 1000;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-secondary);
        }
        
        .empty-state h2 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                align-items: stretch;
            }
            
            .controls-content {
                flex-direction: column;
            }
            
            .search-box {
                min-width: 100%;
            }
            
            .file-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
            
            .issue-item {
                flex-direction: column;
            }
        }
        
        /* Code Highlighting */
        .hljs-keyword { color: #d73a49; }
        .hljs-string { color: #032f62; }
        .hljs-comment { color: #6a737d; }
        .hljs-number { color: #005cc5; }
        .hljs-function { color: #6f42c1; }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <h1 class="title">
                <span>🛡️</span>
                <span>Code Analysis Dashboard</span>
            </h1>
            <div class="stats-bar" id="statsBar">
                <div class="stat-badge total" onclick="filterBySeverity('all')">
                    <span>Total</span>
                    <span>9</span>
                </div>
                <div class="stat-badge error" onclick="filterBySeverity('error')">
                    <span>Errors</span>
                    <span>3</span>
                </div>
                <div class="stat-badge warning" onclick="filterBySeverity('warning')">
                    <span>Warnings</span>
                    <span>0</span>
                </div>
                <div class="stat-badge style" onclick="filterBySeverity('style')">
                    <span>Style</span>
                    <span>4</span>
                </div>
                <div class="stat-badge performance" onclick="filterBySeverity('performance')">
                    <span>Performance</span>
                    <span>0</span>
                </div>
            </div>
        </div>
    </div>
    
    <div class="controls">
        <div class="controls-content">
            <div class="search-box">
                <input type="text" class="search-input" id="searchInput" 
                       placeholder="Search issues... (e.g., 'error in .h', 'warning controller', 'override')"
                       onkeyup="handleSearch(event)">
                <span class="search-hint">Press /</span>
            </div>
            <div class="control-buttons">
                <button class="control-btn" onclick="toggleGrouping()">
                    Group by File
                </button>
                <button class="control-btn" onclick="exportData()">
                    Export
                </button>
                <button class="control-btn" onclick="showHelp()">
                    Help
                </button>
            </div>
        </div>
    </div>
    
    <div class="main-content">
        <div class="progress-section">
            <div class="progress-header">
                <span>Progress: <span id="progressText">0 / 9 issues reviewed</span></span>
                <span><span id="fixedCount">0</span> fixed</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
        </div>
        
        <div id="issuesContainer">
            <!-- Issues will be rendered here -->
        </div>
        
        <div class="loading" id="loading">
            Loading issues...
        </div>
        
        <div class="empty-state" id="emptyState" style="display: none;">
            <h2>No issues found</h2>
            <p>Try adjusting your filters or search criteria</p>
        </div>
    </div>
    
    <button class="theme-toggle" onclick="toggleTheme()" title="Toggle theme">
        <span id="themeIcon">🌙</span>
    </button>
    
    <div class="toast" id="toast"></div>
    
    <script>
        // Global state
        const state = {
            issues: [{"id": "missingIncludeSystem", "severity": "information", "message": "Include file: <iostream> not found. Please note: Cppcheck does not need standard library headers to get proper results.", "file": "test-project/test.cpp", "line": 1, "unique_id": "9f54c856"}, {"id": "memleak", "severity": "error", "message": "Memory leak: leak", "file": "test-project/test.cpp", "line": 12, "unique_id": "4b91973e"}, {"id": "nullPointer", "severity": "error", "message": "Null pointer dereference: ptr", "file": "test-project/test.cpp", "line": 5, "unique_id": "dd3df122"}, {"id": "constVariablePointer", "severity": "style", "message": "Variable 'leak' can be declared as pointer to const", "file": "test-project/test.cpp", "line": 10, "unique_id": "b2cad4eb"}, {"id": "uninitvar", "severity": "error", "message": "Uninitialized variable: uninit", "file": "test-project/test.cpp", "line": 8, "unique_id": "2b2da758"}, {"id": "unreadVariable", "severity": "style", "message": "Variable 'leak' is assigned a value that is never used.", "file": "test-project/test.cpp", "line": 10, "unique_id": "76b947b6"}, {"id": "unassignedVariable", "severity": "style", "message": "Variable 'uninit' is not assigned a value.", "file": "test-project/test.cpp", "line": 7, "unique_id": "4fd44dc7"}, {"id": "unusedAllocatedMemory", "severity": "style", "message": "Variable 'leak' is allocated memory that is never used.", "file": "test-project/test.cpp", "line": 10, "unique_id": "ca64a5df"}, {"id": "checkersReport", "severity": "information", "message": "Active checkers: 167/856 (use --checkers-report=<filename> to see details)", "file": "", "line": 0, "unique_id": "b1cdadb2"}],
            fileGroups: {"test-project/test.cpp": [{"id": "missingIncludeSystem", "severity": "information", "message": "Include file: <iostream> not found. Please note: Cppcheck does not need standard library headers to get proper results.", "file": "test-project/test.cpp", "line": 1, "unique_id": "9f54c856"}, {"id": "memleak", "severity": "error", "message": "Memory leak: leak", "file": "test-project/test.cpp", "line": 12, "unique_id": "4b91973e"}, {"id": "nullPointer", "severity": "error", "message": "Null pointer dereference: ptr", "file": "test-project/test.cpp", "line": 5, "unique_id": "dd3df122"}, {"id": "constVariablePointer", "severity": "style", "message": "Variable 'leak' can be declared as pointer to const", "file": "test-project/test.cpp", "line": 10, "unique_id": "b2cad4eb"}, {"id": "uninitvar", "severity": "error", "message": "Uninitialized variable: uninit", "file": "test-project/test.cpp", "line": 8, "unique_id": "2b2da758"}, {"id": "unreadVariable", "severity": "style", "message": "Variable 'leak' is assigned a value that is never used.", "file": "test-project/test.cpp", "line": 10, "unique_id": "76b947b6"}, {"id": "unassignedVariable", "severity": "style", "message": "Variable 'uninit' is not assigned a value.", "file": "test-project/test.cpp", "line": 7, "unique_id": "4fd44dc7"}, {"id": "unusedAllocatedMemory", "severity": "style", "message": "Variable 'leak' is allocated memory that is never used.", "file": "test-project/test.cpp", "line": 10, "unique_id": "ca64a5df"}], "": [{"id": "checkersReport", "severity": "information", "message": "Active checkers: 167/856 (use --checkers-report=<filename> to see details)", "file": "", "line": 0, "unique_id": "b1cdadb2"}]},
            currentFilter: 'all',
            searchQuery: '',
            groupByFile: true,
            viewed: new Set(),
            fixed: new Set(),
            expandedFiles: new Set()
        };
        
        // Fix patterns
        const fixPatterns = {"missingOverride": {"pattern": "override", "suggestion": "Add override specifier to virtual function", "fix_template": "void functionName() override"}, "passedByValue": {"pattern": "passed by value", "suggestion": "Pass by const reference instead", "fix_template": "const Type& param"}, "uninitMemberVar": {"pattern": "not initialized", "suggestion": "Initialize member in constructor", "fix_template": "ClassName() : member() {}"}, "cstyleCast": {"pattern": "C-style cast", "suggestion": "Use static_cast instead", "fix_template": "static_cast<Type>(value)"}, "useNullptr": {"pattern": "NULL", "suggestion": "Use nullptr instead of NULL", "fix_template": "nullptr"}, "constParameter": {"pattern": "can be declared with const", "suggestion": "Add const qualifier", "fix_template": "const Type param"}, "explicitConstructor": {"pattern": "should be explicit", "suggestion": "Add explicit keyword", "fix_template": "explicit ClassName(param)"}};
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            restoreState();
            applyTheme();
            renderIssues();
            updateProgress();
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (e.key === '/' && e.target.tagName !== 'INPUT') {
                    e.preventDefault();
                    document.getElementById('searchInput').focus();
                }
                if (e.key === 'Escape') {
                    document.getElementById('searchInput').blur();
                }
                if (e.key >= '1' && e.key <= '5' && e.ctrlKey) {
                    e.preventDefault();
                    const severities = ['all', 'error', 'warning', 'style', 'performance'];
                    filterBySeverity(severities[parseInt(e.key) - 1]);
                }
            });
            
            // Hide loading
            document.getElementById('loading').style.display = 'none';
        });
        
        // State management
        function saveState() {
            const stateData = {
                viewed: [...state.viewed],
                fixed: [...state.fixed],
                expandedFiles: [...state.expandedFiles],
                currentFilter: state.currentFilter,
                groupByFile: state.groupByFile
            };
            localStorage.setItem('dashboardState', JSON.stringify(stateData));
        }
        
        function restoreState() {
            const saved = localStorage.getItem('dashboardState');
            if (saved) {
                const data = JSON.parse(saved);
                state.viewed = new Set(data.viewed || []);
                state.fixed = new Set(data.fixed || []);
                state.expandedFiles = new Set(data.expandedFiles || []);
                state.currentFilter = data.currentFilter || 'all';
                state.groupByFile = data.groupByFile !== false;
            }
        }
        
        // Theme management
        function applyTheme() {
            const theme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', theme);
            document.getElementById('themeIcon').textContent = theme === 'dark' ? '☀️' : '🌙';
        }
        
        function toggleTheme() {
            const current = document.documentElement.getAttribute('data-theme');
            const next = current === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', next);
            localStorage.setItem('theme', next);
            document.getElementById('themeIcon').textContent = next === 'dark' ? '☀️' : '🌙';
        }
        
        // Rendering
        function renderIssues() {
            const container = document.getElementById('issuesContainer');
            container.innerHTML = '';
            
            const filteredIssues = getFilteredIssues();
            
            if (filteredIssues.length === 0) {
                document.getElementById('emptyState').style.display = 'block';
                return;
            }
            
            document.getElementById('emptyState').style.display = 'none';
            
            if (state.groupByFile) {
                renderGroupedIssues(filteredIssues);
            } else {
                renderFlatIssues(filteredIssues);
            }
        }
        
        function renderGroupedIssues(issues) {
            const container = document.getElementById('issuesContainer');
            const fileMap = new Map();
            
            // Group filtered issues by file
            issues.forEach(issue => {
                const file = issue.file || 'Unknown';
                if (!fileMap.has(file)) {
                    fileMap.set(file, []);
                }
                fileMap.get(file).push(issue);
            });
            
            // Sort files by issue count
            const sortedFiles = Array.from(fileMap.entries())
                .sort((a, b) => b[1].length - a[1].length);
            
            sortedFiles.forEach(([file, fileIssues]) => {
                const fileGroup = createFileGroup(file, fileIssues);
                container.appendChild(fileGroup);
            });
        }
        
        function createFileGroup(file, issues) {
            const group = document.createElement('div');
            group.className = 'file-group';
            
            const header = document.createElement('div');
            header.className = 'file-header';
            header.onclick = () => toggleFileGroup(file);
            
            const fileInfo = document.createElement('div');
            fileInfo.className = 'file-info';
            
            const fileName = document.createElement('div');
            fileName.className = 'file-name';
            fileName.textContent = file;
            
            const issueCount = document.createElement('div');
            issueCount.className = 'issue-count';
            issueCount.textContent = `${issues.length} issue${issues.length > 1 ? 's' : ''}`;
            
            const severityDots = document.createElement('div');
            severityDots.className = 'severity-dots';
            
            // Show severity distribution
            const severityCounts = {};
            issues.forEach(issue => {
                const sev = issue.severity || 'style';
                severityCounts[sev] = (severityCounts[sev] || 0) + 1;
            });
            
            ['error', 'warning', 'style', 'performance', 'information'].forEach(sev => {
                const count = severityCounts[sev] || 0;
                for (let i = 0; i < Math.min(count, 5); i++) {
                    const dot = document.createElement('div');
                    dot.className = `severity-dot ${sev}`;
                    severityDots.appendChild(dot);
                }
            });
            
            fileInfo.appendChild(fileName);
            fileInfo.appendChild(issueCount);
            fileInfo.appendChild(severityDots);
            
            const toggle = document.createElement('div');
            toggle.className = 'file-toggle';
            toggle.textContent = state.expandedFiles.has(file) ? '▼' : '▶';
            
            header.appendChild(fileInfo);
            header.appendChild(toggle);
            
            const issuesContainer = document.createElement('div');
            issuesContainer.className = 'issues-container';
            if (state.expandedFiles.has(file)) {
                issuesContainer.classList.add('expanded');
            }
            
            issues.forEach(issue => {
                const issueEl = createIssueElement(issue);
                issuesContainer.appendChild(issueEl);
            });
            
            group.appendChild(header);
            group.appendChild(issuesContainer);
            
            return group;
        }
        
        function createIssueElement(issue) {
            const item = document.createElement('div');
            item.className = 'issue-item';
            if (state.viewed.has(issue.unique_id)) {
                item.classList.add('viewed');
            }
            if (state.fixed.has(issue.unique_id)) {
                item.classList.add('fixed');
            }
            
            // Severity badge
            const severity = document.createElement('div');
            severity.className = `issue-severity ${issue.severity || 'style'}`;
            severity.textContent = issue.severity || 'style';
            severity.style.background = getSeverityColor(issue.severity);
            severity.style.color = 'white';
            
            // Content
            const content = document.createElement('div');
            content.className = 'issue-content';
            
            const message = document.createElement('div');
            message.className = 'issue-message';
            message.textContent = issue.message || 'No message';
            
            // Inline code preview
            const codeLines = getInlineCode(issue);
            if (codeLines.length > 0) {
                const codePreview = document.createElement('div');
                codePreview.className = 'issue-code';
                codePreview.textContent = codeLines.map(line => 
                    `${line.line_number}: ${line.content}`
                ).join('\n');
                content.appendChild(codePreview);
            }
            
            const meta = document.createElement('div');
            meta.className = 'issue-meta';
            meta.innerHTML = `
                <span>Line ${issue.line || '?'}</span>
                <span>ID: ${issue.id || 'unknown'}</span>
                <span>Column: ${issue.column || '?'}</span>
            `;
            
            content.appendChild(message);
            content.appendChild(meta);
            
            // Actions
            const actions = document.createElement('div');
            actions.className = 'issue-actions';
            
            // View button
            const viewBtn = document.createElement('button');
            viewBtn.className = 'action-btn';
            viewBtn.textContent = state.viewed.has(issue.unique_id) ? '✓' : '👁';
            viewBtn.onclick = () => markAsViewed(issue);
            
            // Fix button
            const fixBtn = document.createElement('button');
            fixBtn.className = 'action-btn';
            fixBtn.textContent = state.fixed.has(issue.unique_id) ? '✓ Fixed' : 'Fix';
            fixBtn.onclick = () => markAsFixed(issue);
            
            actions.appendChild(viewBtn);
            actions.appendChild(fixBtn);
            
            // Quick fix suggestion
            const fix = getFixSuggestion(issue);
            if (fix) {
                const fixSuggestion = document.createElement('button');
                fixSuggestion.className = 'action-btn fix-suggestion';
                fixSuggestion.textContent = '💡';
                fixSuggestion.title = fix.suggestion;
                fixSuggestion.onclick = () => showFixSuggestion(fix);
                actions.appendChild(fixSuggestion);
            }
            
            item.appendChild(severity);
            item.appendChild(content);
            item.appendChild(actions);
            
            // Mark as viewed on click
            item.onclick = () => markAsViewed(issue);
            
            return item;
        }
        
        function renderFlatIssues(issues) {
            const container = document.getElementById('issuesContainer');
            issues.forEach(issue => {
                const issueEl = createIssueElement(issue);
                container.appendChild(issueEl);
            });
        }
        
        // Filtering
        function getFilteredIssues() {
            let filtered = state.issues;
            
            // Filter by severity
            if (state.currentFilter !== 'all') {
                filtered = filtered.filter(issue => issue.severity === state.currentFilter);
            }
            
            // Filter by search
            if (state.searchQuery) {
                filtered = filtered.filter(issue => matchesSearch(issue, state.searchQuery));
            }
            
            return filtered;
        }
        
        function matchesSearch(issue, query) {
            const parts = query.toLowerCase().split(' ');
            const issueText = `${issue.message} ${issue.file} ${issue.id}`.toLowerCase();
            
            return parts.every(part => {
                // Check for severity filter
                if (['error', 'warning', 'style', 'performance'].includes(part)) {
                    return issue.severity === part;
                }
                
                // Check for file extension
                if (part.startsWith('.')) {
                    return issue.file && issue.file.endsWith(part);
                }
                
                // Check for file path
                if (part.includes('/')) {
                    return issue.file && issue.file.includes(part);
                }
                
                // General text search
                return issueText.includes(part);
            });
        }
        
        function filterBySeverity(severity) {
            state.currentFilter = severity;
            
            // Update active button
            document.querySelectorAll('.stat-badge').forEach(badge => {
                badge.classList.remove('active');
            });
            
            if (severity === 'all') {
                document.querySelector('.stat-badge.total').classList.add('active');
            } else {
                document.querySelector(`.stat-badge.${severity}`).classList.add('active');
            }
            
            renderIssues();
            showToast(`Showing ${severity === 'all' ? 'all issues' : severity + ' issues'}`);
        }
        
        function handleSearch(event) {
            state.searchQuery = event.target.value;
            renderIssues();
        }
        
        // Actions
        function markAsViewed(issue) {
            if (!state.viewed.has(issue.unique_id)) {
                state.viewed.add(issue.unique_id);
                saveState();
                updateProgress();
                renderIssues();
            }
        }
        
        function markAsFixed(issue) {
            if (state.fixed.has(issue.unique_id)) {
                state.fixed.delete(issue.unique_id);
            } else {
                state.fixed.add(issue.unique_id);
                state.viewed.add(issue.unique_id);
            }
            saveState();
            updateProgress();
            renderIssues();
        }
        
        function toggleFileGroup(file) {
            if (state.expandedFiles.has(file)) {
                state.expandedFiles.delete(file);
            } else {
                state.expandedFiles.add(file);
            }
            saveState();
            renderIssues();
        }
        
        function toggleGrouping() {
            state.groupByFile = !state.groupByFile;
            saveState();
            renderIssues();
            showToast(state.groupByFile ? 'Grouping by file' : 'Flat view');
        }
        
        // Progress tracking
        function updateProgress() {
            const total = state.issues.length;
            const viewed = state.viewed.size;
            const fixed = state.fixed.size;
            
            document.getElementById('progressText').textContent = `${viewed} / ${total} issues reviewed`;
            document.getElementById('fixedCount').textContent = fixed;
            
            const percentage = total > 0 ? (viewed / total) * 100 : 0;
            document.getElementById('progressFill').style.width = `${percentage}%`;
        }
        
        // Utilities
        function getSeverityColor(severity) {
            const colors = {
                error: '#dc3545',
                warning: '#f39c12',
                style: '#6f42c1',
                performance: '#198754',
                information: '#0dcaf0',
                portability: '#6c757d'
            };
            return colors[severity] || '#6c757d';
        }
        
        function getInlineCode(issue) {
            if (!issue.context || !issue.context.code_lines) return [];
            
            const lines = issue.context.code_lines;
            const targetLine = issue.line;
            
            // Find the target line
            for (let i = 0; i < lines.length; i++) {
                if (lines[i].line_number === targetLine) {
                    const result = [];
                    if (i > 0) result.push(lines[i-1]);
                    result.push(lines[i]);
                    if (i < lines.length - 1 && result.length < 2) {
                        result.push(lines[i+1]);
                    }
                    return result;
                }
            }
            
            return lines.slice(0, 2);
        }
        
        function getFixSuggestion(issue) {
            const message = (issue.message || '').toLowerCase();
            
            for (const [fixId, pattern] of Object.entries(fixPatterns)) {
                if (message.includes(pattern.pattern)) {
                    return {
                        id: fixId,
                        suggestion: pattern.suggestion,
                        template: pattern.fix_template
                    };
                }
            }
            
            return null;
        }
        
        function showFixSuggestion(fix) {
            showToast(`${fix.suggestion}: ${fix.template}`);
            navigator.clipboard.writeText(fix.template);
        }
        
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
        
        function exportData() {
            const exportData = {
                issues: getFilteredIssues(),
                viewed: [...state.viewed],
                fixed: [...state.fixed],
                timestamp: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `code-analysis-export-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showToast('Data exported successfully');
        }
        
        function showHelp() {
            const helpText = `
Keyboard Shortcuts:
• / - Focus search
• Ctrl+1-5 - Filter by severity
• Esc - Unfocus search

Search Examples:
• "error in .h" - Errors in header files
• "warning controller" - Warnings with "controller"
• "style multiply" - Style issues with "multiply"
• ".cpp" - Issues in .cpp files
            `;
            alert(helpText);
        }
    </script>
</body>
</html>