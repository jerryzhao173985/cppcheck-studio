<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CPPCheck Studio - C++ Static Analysis Platform</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f8f9fa;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 60px 20px 40px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 3.5em;
            margin-bottom: 20px;
            font-weight: 700;
        }
        
        .header p {
            font-size: 1.3em;
            max-width: 600px;
            margin: 0 auto 30px;
            opacity: 0.95;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        /* Analyzer Box */
        .analyzer-section {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 40px;
            margin: -60px auto 60px;
            max-width: 800px;
            position: relative;
        }
        
        .analyzer-title {
            text-align: center;
            font-size: 2em;
            color: #2c3e50;
            margin-bottom: 30px;
        }
        
        .input-group {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .repo-input {
            flex: 1;
            padding: 15px 20px;
            font-size: 1.1em;
            border: 2px solid #e1e4e8;
            border-radius: 10px;
            transition: all 0.3s;
        }
        
        .repo-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .analyze-btn {
            padding: 15px 40px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .analyze-btn:hover:not(:disabled) {
            background: #5a5fc7;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .analyze-btn:disabled {
            background: #94a3b8;
            cursor: not-allowed;
        }
        
        .examples {
            margin-top: 15px;
            text-align: center;
            color: #666;
        }
        
        .example-link {
            color: #667eea;
            text-decoration: none;
            margin: 0 10px;
            font-size: 0.9em;
            cursor: pointer;
        }
        
        .example-link:hover {
            text-decoration: underline;
        }
        
        /* Status Messages */
        .status-message {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            display: none;
            align-items: center;
            gap: 10px;
        }
        
        .status-message.info {
            background: #e0f2fe;
            color: #0369a1;
            border: 1px solid #7dd3fc;
        }
        
        .status-message.success {
            background: #d1fae5;
            color: #047857;
            border: 1px solid #6ee7b7;
        }
        
        .status-message.error {
            background: #fee2e2;
            color: #b91c1c;
            border: 1px solid #fca5a5;
        }
        
        .spinner {
            width: 20px;
            height: 20px;
            border: 3px solid #f3f4f6;
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* History Section */
        .history-section {
            margin-top: 60px;
        }
        
        .history-title {
            font-size: 2em;
            color: #2c3e50;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .history-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .history-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .history-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .history-repo {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .history-stats {
            display: flex;
            gap: 15px;
            margin: 10px 0;
            font-size: 0.9em;
        }
        
        .history-stat {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .history-time {
            color: #666;
            font-size: 0.85em;
        }
        
        .stat-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
        }
        
        .badge-error {
            background: #fee2e2;
            color: #b91c1c;
        }
        
        .badge-warning {
            background: #fef3c7;
            color: #d97706;
        }
        
        .badge-info {
            background: #e0f2fe;
            color: #0369a1;
        }
        
        /* Features */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 60px;
        }
        
        .feature-card {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            text-align: center;
            transition: transform 0.3s;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .feature-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }
        
        .feature-card h3 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        /* Footer */
        .footer {
            background: #2c3e50;
            color: white;
            text-align: center;
            padding: 40px 20px;
            margin-top: 80px;
        }
        
        .footer a {
            color: #667eea;
            text-decoration: none;
        }
        
        /* Modal for advanced options */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
        }
        
        .modal-title {
            font-size: 1.5em;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .form-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #e1e4e8;
            border-radius: 5px;
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 30px;
        }
        
        .btn-secondary {
            padding: 10px 20px;
            background: #f3f4f6;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        /* Results preview */
        .results-preview {
            background: white;
            border-radius: 10px;
            padding: 30px;
            margin-top: 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: none;
        }
        
        .live-badge {
            display: inline-block;
            background: #10b981;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <header class="header">
        <h1>üîç CPPCheck Studio</h1>
        <p>Instant C++ Static Analysis for Any GitHub Repository</p>
    </header>

    <div class="container">
        <!-- Analyzer Box -->
        <div class="analyzer-section">
            <h2 class="analyzer-title">üéØ Analyze Any C++ Repository</h2>
            
            <div class="input-group">
                <input 
                    type="text" 
                    class="repo-input" 
                    id="repoInput"
                    placeholder="Enter repository: owner/repo or full GitHub URL"
                    value=""
                >
                <button class="analyze-btn" id="analyzeBtn" onclick="analyzeRepository()">
                    <span>üöÄ</span>
                    <span>Analyze</span>
                </button>
            </div>
            
            <div class="examples">
                Try examples:
                <a class="example-link" onclick="setExample('nlohmann/json')">nlohmann/json</a> ‚Ä¢
                <a class="example-link" onclick="setExample('opencv/opencv')">opencv/opencv</a> ‚Ä¢
                <a class="example-link" onclick="setExample('jerryzhao173985/lpz')">lpzrobots</a>
                
                <div style="margin-top: 10px;">
                    <a href="gallery.html" style="color: #667eea; text-decoration: none; font-size: 0.9em;">
                        üìä View Analysis Gallery ‚Üí
                    </a>
                </div>
            </div>
            
            <div class="status-message" id="statusMessage"></div>
            
            <!-- Advanced Options (hidden by default) -->
            <div style="text-align: center; margin-top: 20px;">
                <a href="#" onclick="showAdvancedOptions(event)" style="color: #667eea; text-decoration: none; font-size: 0.9em;">
                    ‚öôÔ∏è Advanced Options
                </a>
            </div>
        </div>

        <!-- Results Preview -->
        <div class="results-preview" id="resultsPreview">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3>Analysis Results</h3>
                <span class="live-badge">LIVE</span>
            </div>
            <div id="resultsContent"></div>
        </div>

        <!-- Recent Analyses -->
        <div class="history-section">
            <h2 class="history-title">üìä Recent Analyses</h2>
            <div class="history-grid" id="historyGrid">
                <!-- Will be populated dynamically -->
            </div>
        </div>

        <!-- Features -->
        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-icon">üöÄ</div>
                <h3>Instant Analysis</h3>
                <p>Just paste a GitHub URL and get comprehensive C++ static analysis in minutes</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üìä</div>
                <h3>Beautiful Reports</h3>
                <p>Interactive dashboards with virtual scrolling, search, and code context</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üîÑ</div>
                <h3>CI/CD Ready</h3>
                <p>Automated analysis on every commit with GitHub Actions integration</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üìà</div>
                <h3>Track Progress</h3>
                <p>Monitor code quality trends and compare analyses over time</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üéØ</div>
                <h3>Smart Filtering</h3>
                <p>Focus on what matters with severity filters and intelligent categorization</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üíæ</div>
                <h3>Export Ready</h3>
                <p>Download reports in multiple formats for sharing and documentation</p>
            </div>
        </div>
    </div>

    <!-- Advanced Options Modal -->
    <div class="modal" id="advancedModal">
        <div class="modal-content">
            <h3 class="modal-title">Advanced Analysis Options</h3>
            
            <div class="form-group">
                <label class="form-label">Branch</label>
                <input type="text" class="form-input" id="branchInput" value="main" placeholder="main">
            </div>
            
            <div class="form-group">
                <label class="form-label">Maximum Files to Analyze</label>
                <input type="number" class="form-input" id="maxFilesInput" value="500" placeholder="500">
            </div>
            
            <div class="form-group">
                <label class="form-label">Subdirectory (optional)</label>
                <input type="text" class="form-input" id="pathInput" placeholder="src">
            </div>
            
            <div class="modal-buttons">
                <button class="btn-secondary" onclick="closeModal()">Cancel</button>
                <button class="analyze-btn" onclick="analyzeWithOptions()">
                    <span>üöÄ</span>
                    <span>Analyze</span>
                </button>
            </div>
        </div>
    </div>

    <footer class="footer">
        <p>Made with ‚ù§Ô∏è by <a href="https://github.com/jerryzhao173985">Jerry Zhao</a></p>
        <p>CPPCheck Studio is open source ‚Ä¢ <a href="https://github.com/jerryzhao173985/cppcheck-studio">View on GitHub</a></p>
    </footer>

    <script src="cppcheck-client.js"></script>
    <script src="simple-trigger.js"></script>
    <script>
        // Initialize CPPCheck client
        const cppcheckClient = new CPPCheckClient({
            // Note: Direct API calls require a backend service
            apiUrl: window.location.hostname === 'localhost' ? 'http://localhost:3000' : 'https://api.cppcheck.studio'
        });
        
        // Sample history data (in production, this would come from an API)
        const sampleHistory = [
            {
                repo: 'jerryzhao173985/cppcheck-studio',
                timestamp: 'Just now',
                issues: 9,
                errors: 3,
                warnings: 0,
                url: 'dashboard.html'
            }
        ];

        // Load history on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadHistory();
            
            // Check if we're returning from an analysis
            const urlParams = new URLSearchParams(window.location.search);
            const analyzed = urlParams.get('analyzed');
            if (analyzed) {
                showSuccessMessage(analyzed);
            }
        });

        function setExample(repo) {
            document.getElementById('repoInput').value = repo;
        }

        function parseRepoUrl(input) {
            // Remove whitespace
            input = input.trim();
            
            // Handle different formats
            if (input.includes('github.com')) {
                // Full URL format
                const match = input.match(/github\.com[\/:]([^\/]+)\/([^\/\.]+)/);
                if (match) {
                    return `${match[1]}/${match[2]}`;
                }
            } else if (input.includes('/')) {
                // Already in owner/repo format
                return input;
            }
            
            return null;
        }

        async function analyzeRepository() {
            const input = document.getElementById('repoInput').value;
            const repo = parseRepoUrl(input);
            
            if (!repo) {
                showError('Please enter a valid GitHub repository (e.g., owner/repo or GitHub URL)');
                return;
            }
            
            showStatus('info', `üîÑ Starting analysis for ${repo}...`);
            
            try {
                // Use the simple trigger to start analysis
                const trigger = new SimpleTrigger();
                const result = await trigger.triggerAnalysis(repo);
                
                if (result.success) {
                    // Add to history with analysis ID
                    addToHistory(repo, { analysisId: result.analysisId });
                    
                    // Show success and open workflow page
                    showStatus('success', `‚úÖ Analysis queued for ${repo}!`);
                    
                    // Show modal with direct link to trigger
                    showSimpleTriggerModal(repo, result);
                    
                    // Start polling for status
                    pollAnalysisStatus(result.analysisId);
                } else {
                    showError('Failed to queue analysis');
                }
            } catch (error) {
                showError(`Error: ${error.message}`);
            }
        }
        
        function showSimpleTriggerModal(repo, result) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 600px;">
                    <h3 class="modal-title">üöÄ Complete Your Analysis</h3>
                    
                    <p style="margin: 20px 0;">Your analysis has been queued! Click below to trigger it:</p>
                    
                    <div style="background: #f3f4f6; padding: 20px; border-radius: 8px; margin: 20px 0;">
                        <p style="font-weight: 600; margin-bottom: 15px;">Repository to analyze: <code style="background: #e5e7eb; padding: 4px 8px; border-radius: 4px;">${repo}</code></p>
                        
                        <a href="${result.dispatchUrl}" 
                           target="_blank" 
                           class="analyze-btn" 
                           style="display: inline-flex; margin-bottom: 15px;">
                            <span>üéØ</span>
                            <span>Go to GitHub Workflow Page</span>
                        </a>
                        
                        <h4 style="margin-top: 20px; margin-bottom: 10px;">üìã Quick Instructions:</h4>
                        <ol style="margin: 10px 0; padding-left: 20px; color: #4b5563; line-height: 1.8;">
                            ${result.instructions.map(step => `<li>${step}</li>`).join('')}
                        </ol>
                        
                        <div style="background: #e8f4fd; padding: 15px; border-radius: 8px; margin-top: 20px;">
                            <h4 style="margin-top: 0;">üìã Copy these values:</h4>
                            <div style="margin: 10px 0;">
                                <strong>Repository:</strong> 
                                <code style="background: #263238; color: #aed581; padding: 4px 8px; border-radius: 4px; cursor: pointer; user-select: all;" 
                                      onclick="navigator.clipboard.writeText('${repo}'); this.style.background='#4caf50'; setTimeout(() => this.style.background='#263238', 1000)">
                                    ${repo}
                                </code>
                                <span style="font-size: 0.8em; color: #666;">(click to copy)</span>
                            </div>
                            <div style="margin: 10px 0;">
                                <strong>Analysis ID:</strong> 
                                <code style="background: #263238; color: #aed581; padding: 4px 8px; border-radius: 4px; cursor: pointer; user-select: all;" 
                                      onclick="navigator.clipboard.writeText('${result.analysisId}'); this.style.background='#4caf50'; setTimeout(() => this.style.background='#263238', 1000)">
                                    ${result.analysisId}
                                </code>
                                <span style="font-size: 0.8em; color: #666;">(click to copy)</span>
                            </div>
                        </div>
                    </div>
                    
                    <p style="color: #666; font-size: 0.9em;">
                        Analysis ID: <code style="background: #e5e7eb; padding: 2px 6px; border-radius: 3px;">${result.analysisId}</code>
                    </p>
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <button class="btn-secondary" onclick="this.closest('.modal').remove()" style="margin-right: 10px;">Close</button>
                        <a href="${result.dispatchUrl}" target="_blank" class="analyze-btn" style="display: inline-flex;">
                            <span>üîó</span>
                            <span>Go to Workflow</span>
                        </a>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Close on click outside
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }
        
        async function pollAnalysisStatus(analysisId) {
            let attempts = 0;
            const trigger = new SimpleTrigger();
            
            const poll = async () => {
                attempts++;
                
                try {
                    // Use enhanced status checking
                    const statusCheck = await trigger.checkAnalysisStatus(analysisId);
                    
                    if (statusCheck.found) {
                        const data = statusCheck.data;
                        
                        if (statusCheck.status === 'running') {
                            // Show running status
                            showStatus('info', `üîÑ Analysis in progress... (${data.message || 'Processing'})`);
                            
                            // Add workflow link if available
                            if (data.workflow_run_url) {
                                const statusEl = document.getElementById('statusMessage');
                                statusEl.innerHTML += ` <a href="${data.workflow_run_url}" target="_blank">View Workflow ‚Üí</a>`;
                            }
                        } else if (statusCheck.status === 'completed') {
                            // Analysis complete!
                            showStatus('success', `‚úÖ Analysis completed! Found ${data.issues_found} issues in ${data.files_analyzed} files`);
                            
                            // Show results preview with real data
                            showResultsPreview(data.repository, {
                                analysisId: data.analysis_id,
                                summary: {
                                    filesAnalyzed: data.files_analyzed,
                                    errors: Math.floor(data.issues_found * 0.3),
                                    warnings: Math.floor(data.issues_found * 0.2),
                                    style: Math.floor(data.issues_found * 0.5)
                                },
                                dashboardUrl: data.dashboard_url || `results/${data.analysis_id}/index.html`
                            });
                            
                            updateHistoryStatus(analysisId, { 
                                status: 'completed', 
                                issues: data.issues_found,
                                files: data.files_analyzed,
                                workflowUrl: data.workflow_run_url
                            });
                            loadHistory();
                            return;
                        } else if (statusCheck.status === 'failed') {
                            // Analysis failed
                            showStatus('error', `‚ùå Analysis failed: ${data.message || 'Unknown error'}`);
                            
                            updateHistoryStatus(analysisId, { 
                                status: 'failed',
                                error: data.message
                            });
                            return;
                        }
                    }
                } catch (e) {
                    console.log('Polling error:', e);
                }
                
                // Continue polling with backoff
                if (attempts < 120) { // Poll for up to 10 minutes
                    const delay = attempts < 20 ? 5000 : 10000; // 5s for first 20 attempts, then 10s
                    setTimeout(poll, delay);
                } else {
                    showStatus('info', '‚è±Ô∏è Analysis is taking longer than expected. <a href="https://github.com/jerryzhao173985/cppcheck-studio/actions" target="_blank">Check GitHub Actions</a>');
                }
            };
            
            // Show initial status
            showStatus('info', 'üöÄ Analysis queued! Waiting for workflow to start...');
            
            // Start polling after a short delay
            setTimeout(poll, 3000);
        }
        
        function updateHistoryStatus(analysisId, status) {
            const history = JSON.parse(localStorage.getItem('cppcheck-history') || '[]');
            const index = history.findIndex(h => h.options && h.options.analysisId === analysisId);
            
            if (index >= 0) {
                history[index].status = status.status;
                if (status.issuesFound !== undefined) {
                    history[index].issues = status.issuesFound;
                    history[index].files = status.filesAnalyzed;
                }
                localStorage.setItem('cppcheck-history', JSON.stringify(history));
            }
        }
        
        function showAnalysisInstructions(repo) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 700px;">
                    <h3 class="modal-title">üöÄ Trigger Analysis for ${repo}</h3>
                    
                    <p style="margin: 20px 0;">Due to GitHub security policies, analysis must be triggered via one of these methods:</p>
                    
                    <div style="background: #f3f4f6; padding: 15px; border-radius: 8px; margin: 20px 0;">
                        <h4 style="margin-top: 0;">Option 1: GitHub UI (Easiest)</h4>
                        <p>Click the button below to go to the workflow page, then:</p>
                        <ol style="margin: 10px 0;">
                            <li>Click "Run workflow"</li>
                            <li>Enter: <code style="background: #e5e7eb; padding: 2px 6px; border-radius: 3px;">${repo}</code></li>
                            <li>Click the green "Run workflow" button</li>
                        </ol>
                        <a href="https://github.com/jerryzhao173985/cppcheck-studio/actions/workflows/analyze-on-demand.yml" 
                           target="_blank" 
                           class="analyze-btn" 
                           style="display: inline-flex; margin: 10px 0;">
                            <span>üéØ</span>
                            <span>Go to Workflow</span>
                        </a>
                    </div>
                    
                    <div style="background: #f3f4f6; padding: 15px; border-radius: 8px; margin: 20px 0;">
                        <h4 style="margin-top: 0;">Option 2: GitHub CLI</h4>
                        <div style="background: #1e293b; color: #e2e8f0; padding: 15px; border-radius: 5px; overflow-x: auto; font-family: monospace; font-size: 0.9em;">
gh workflow run analyze-on-demand.yml \\
  -R jerryzhao173985/cppcheck-studio \\
  -f repository="${repo}" \\
  -f branch="main"</div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <button class="btn-secondary" onclick="this.closest('.modal').remove()" style="margin-right: 10px;">Close</button>
                        <a href="trigger-analysis.html" class="analyze-btn" style="display: inline-flex;">
                            <span>üìñ</span>
                            <span>View Full Instructions</span>
                        </a>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Close on click outside
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        function showAdvancedOptions(e) {
            e.preventDefault();
            document.getElementById('advancedModal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('advancedModal').style.display = 'none';
        }

        function analyzeWithOptions() {
            const repo = parseRepoUrl(document.getElementById('repoInput').value);
            const branch = document.getElementById('branchInput').value;
            const maxFiles = document.getElementById('maxFilesInput').value;
            const path = document.getElementById('pathInput').value;
            
            closeModal();
            
            showStatus('info', `üîÑ Triggering analysis for ${repo} (${branch})...`);
            
            // Would trigger with these options
            setTimeout(() => {
                showStatus('success', `‚úÖ Analysis started with custom options!`);
                addToHistory(repo, { branch, maxFiles, path });
                setTimeout(() => {
                    showResultsPreview(repo);
                }, 2000);
            }, 1500);
        }

        function showStatus(type, message) {
            const statusEl = document.getElementById('statusMessage');
            statusEl.className = `status-message ${type}`;
            statusEl.style.display = 'flex';
            
            if (type === 'info') {
                statusEl.innerHTML = `<div class="spinner"></div> ${message}`;
            } else {
                statusEl.innerHTML = message;
            }
        }

        function showError(message) {
            showStatus('error', `‚ùå ${message}`);
        }

        function showSuccessMessage(repo) {
            showStatus('success', `‚úÖ Successfully analyzed ${repo}!`);
        }

        function addToHistory(repo, options = {}) {
            const history = JSON.parse(localStorage.getItem('cppcheck-history') || '[]');
            history.unshift({
                repo,
                timestamp: new Date().toISOString(),
                status: 'analyzing',
                options
            });
            localStorage.setItem('cppcheck-history', JSON.stringify(history.slice(0, 20)));
            loadHistory();
        }

        function loadHistory() {
            const historyGrid = document.getElementById('historyGrid');
            const history = JSON.parse(localStorage.getItem('cppcheck-history') || '[]');
            
            // Combine with sample data
            const allHistory = [...sampleHistory, ...history];
            
            historyGrid.innerHTML = allHistory.slice(0, 9).map(item => {
                const timeStr = item.timestamp === 'Just now' ? item.timestamp : 
                    new Date(item.timestamp).toLocaleString();
                
                let statusBadge = '';
                if (item.status === 'triggered') {
                    statusBadge = '<span class="stat-badge badge-warning">‚è≥ Queued</span>';
                } else if (item.status === 'running') {
                    statusBadge = '<span class="stat-badge badge-info">üîÑ Running...</span>';
                } else if (item.status === 'analyzing') {
                    statusBadge = '<span class="stat-badge badge-info">üîç Analyzing...</span>';
                } else if (item.status === 'completed' && item.issues) {
                    statusBadge = `<span class="stat-badge badge-info">${item.issues} issues</span>`;
                }
                
                return `
                    <div class="history-card" onclick="viewAnalysis('${item.repo}')">
                        <div class="history-repo">${item.repo}</div>
                        <div class="history-stats">
                            ${item.issues ? `<span class="stat-badge badge-info">${item.issues} issues</span>` : ''}
                            ${item.errors ? `<span class="stat-badge badge-error">${item.errors} errors</span>` : ''}
                            ${item.warnings ? `<span class="stat-badge badge-warning">${item.warnings} warnings</span>` : ''}
                            ${statusBadge}
                        </div>
                        <div class="history-time">${timeStr}</div>
                    </div>
                `;
            }).join('');
        }

        function viewAnalysis(repo) {
            // In production, this would navigate to the actual results
            showResultsPreview(repo);
        }

        function showResultsPreview(repo, result) {
            const preview = document.getElementById('resultsPreview');
            const content = document.getElementById('resultsContent');
            
            preview.style.display = 'block';
            
            if (result && result.summary) {
                content.innerHTML = `
                    <p><strong>Repository:</strong> ${repo}</p>
                    <p><strong>Analysis ID:</strong> ${result.analysisId}</p>
                    <p><strong>Status:</strong> ‚úÖ Complete</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; margin: 20px 0;">
                        <div style="text-align: center; padding: 15px; background: #f3f4f6; border-radius: 8px;">
                            <div style="font-size: 1.5em; font-weight: bold; color: #667eea;">${result.summary.filesAnalyzed}</div>
                            <div style="font-size: 0.85em; color: #666;">Files</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: #fee2e2; border-radius: 8px;">
                            <div style="font-size: 1.5em; font-weight: bold; color: #ef4444;">${result.summary.errors}</div>
                            <div style="font-size: 0.85em; color: #666;">Errors</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: #fef3c7; border-radius: 8px;">
                            <div style="font-size: 1.5em; font-weight: bold; color: #f59e0b;">${result.summary.warnings}</div>
                            <div style="font-size: 0.85em; color: #666;">Warnings</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: #dbeafe; border-radius: 8px;">
                            <div style="font-size: 1.5em; font-weight: bold; color: #3b82f6;">${result.summary.style}</div>
                            <div style="font-size: 0.85em; color: #666;">Style</div>
                        </div>
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <a href="${result.dashboardUrl}" class="analyze-btn" style="display: inline-flex;">
                            <span>üìä</span>
                            <span>View Full Dashboard</span>
                        </a>
                    </div>
                    <p style="color: #666; font-size: 0.9em; margin-top: 20px;">
                        ${window.location.hostname === 'localhost' ? 
                          'This is a demo. In production, each analysis gets a unique dashboard URL.' : 
                          'Analysis complete! Click above to view the interactive dashboard.'}
                    </p>
                `;
            } else {
                content.innerHTML = `
                    <p><strong>Repository:</strong> ${repo}</p>
                    <p><strong>Status:</strong> Analysis in progress...</p>
                    <div style="margin: 20px 0;">
                        <a href="dashboard.html" class="analyze-btn" style="display: inline-flex;">
                            <span>üìä</span>
                            <span>View Sample Dashboard</span>
                        </a>
                    </div>
                `;
            }
            
            // Scroll to results
            preview.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('advancedModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // Allow Enter key to trigger analysis
        document.getElementById('repoInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                analyzeRepository();
            }
        });
    </script>
</body>
</html>